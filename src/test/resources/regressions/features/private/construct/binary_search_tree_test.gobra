// Any copyright is dedicated to the Public Domain.
// http://creativecommons.org/publicdomain/zero/1.0/

package main

// ##(-I ./)
import bst "binary_search_tree"

func main() {
    value0 := 2
    value1 := 5
    value2 := 42
    t := client0(value0)
    client1(t, value1)
    client2(t, value2)
}

func client() {
    t := &bst.Tree{}
    t.Insert(5)
    assert !t.IsEmpty()
    t.Delete(5)
    //assert t.IsEmpty()
}

ensures t.Tree()
func client0(value int) (t *bst.Tree) {
    t = &bst.Tree{}
    t.Insert(value)
    assert t.SortedValues() == seq[int]{ value }
    t.Delete(value)
    return t
}

requires t.Tree()
ensures t.Tree()
func client1(t *bst.Tree, value int) {
    var oldValues = t.SortedValues()
    bst.Contains(t, value, 2) // passing a fractional permission of t.Tree() enables proof that the tree values remain unchanged
    var newValues = t.SortedValues()
    //assert oldValues == newValues
}

requires t.Tree()
ensures t.Tree()
func client2(t *bst.Tree, value int) {
    var oldValues = t.SortedValues()
    // insert a new value
    t.Insert(value)
    var newValues = t.SortedValues()
    //assert t.PureContains(value, 2)
    ghost if (value in oldValues) {
        assert oldValues == newValues
    } else {
        // this cannot be proven:
        // assert newValues == insertIntoSortedSeq(oldValues, value)
    }
}




